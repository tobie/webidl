
<script>
    (function() {
        function wrap(s) { return "<pre class=grammar>" + s + "</pre>"; }
        var output = "";
        [].forEach.call(document.querySelectorAll("pre.grammar"), pre => {
            var html = pre.textContent.replace(/("[^"]+")|([a-zA-Z]+)|(:)/g, m => {
                if (/^"/.test(m)) { return "<emu-t>" + m.replace(/^"|"$/g, "") + "</emu-t>"; }
                if (m == ":") { return "::"; }
                if (document.querySelector("#prod-" + m)) {
                  return "<emu-nt><a href=\"#prod-" + m + "\">" + m + "</a></emu-nt>";
                }
                return "<emu-nt>" + m + "</emu-nt>"
            });
            
            pre.innerHTML = html;
            var fillWith = document.querySelectorAll("div[data-fill-with=\"grammar-" + pre.id.replace("prod-", "") + "\"]");
            [].forEach.call(fillWith, div => div.innerHTML = wrap(html))
            
            if (!(/\bno-index\b/).test(pre.className)) {
              output += html + "\n";
            }
        });
        document.querySelector("div[data-fill-with=\"grammar-index\"]").innerHTML = wrap(output);
    })();
</script>
